<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Create a new child process duplicating the parent process (see fork(2))."><title>fork in nix::unistd - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="nix" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../nix/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../nix/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><div class="sidebar-elems"><h2><a href="index.html">In nix::unistd</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">nix</a>::<wbr><a href="index.html">unistd</a>::<wbr><a class="fn" href="#">fork</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/nix/unistd.rs.html#292-300">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub unsafe fn fork() -&gt; <a class="type" href="../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="enum" href="enum.ForkResult.html" title="enum nix::unistd::ForkResult">ForkResult</a>&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Create a new child process duplicating the parent process (<a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/fork.html">see
fork(2)</a>).</p>
<p>After successfully calling the fork system call, a second process will
be created which is identical to the original except for the pid and the
return value of this function.  As an example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>nix::{sys::wait::waitpid,unistd::{fork, ForkResult, write}};

<span class="kw">match unsafe</span>{fork()} {
   <span class="prelude-val">Ok</span>(ForkResult::Parent { child, .. }) =&gt; {
       <span class="macro">println!</span>(<span class="string">&quot;Continuing execution in parent process, new child has pid: {}&quot;</span>, child);
       waitpid(child, <span class="prelude-val">None</span>).unwrap();
   }
   <span class="prelude-val">Ok</span>(ForkResult::Child) =&gt; {
       <span class="comment">// Unsafe to use `println!` (or `unwrap`) here. See Safety.
       </span>write(libc::STDOUT_FILENO, <span class="string">&quot;I&#39;m a new child process\n&quot;</span>.as_bytes()).ok();
       <span class="kw">unsafe </span>{ libc::_exit(<span class="number">0</span>) };
   }
   <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; <span class="macro">println!</span>(<span class="string">&quot;Fork failed&quot;</span>),
}</code></pre></div>
<p>This will print something like the following (order nondeterministic).  The
thing to note is that you end up with two processes continuing execution
immediately after the fork call but with different match arms.</p>
<div class="example-wrap"><pre class="language-text"><code>Continuing execution in parent process, new child has pid: 1234
I&#39;m a new child process
</code></pre></div><h2 id="safety"><a href="#safety">Safety</a></h2>
<p>In a multithreaded program, only <a href="https://man7.org/linux/man-pages/man7/signal-safety.7.html">async-signal-safe</a> functions like <code>pause</code>
and <code>_exit</code> may be called by the child (the parent isn’t restricted). Note
that memory allocation may <strong>not</strong> be async-signal-safe and thus must be
prevented.</p>
<p>Those functions are only a small subset of your operating system’s API, so
special care must be taken to only invoke code you can control and audit.</p>
</div></details></section></div></main></body></html>