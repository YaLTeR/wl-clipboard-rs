<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait which provides an implementation for handling a client’s requests from a resource with some type of associated user data."><title>Dispatch in wayland_server - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-9bb858ba049f1f21.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="wayland_server" data-themes="" data-resource-suffix="" data-rustdoc-version="1.72.1 (d5c2e9c34 2023-09-13)" data-channel="1.72.1" data-search-js="search-f6292fe389d70017.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ><script src="../static.files/storage-59fd9b8ccb335783.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../wayland_server/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../wayland_server/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Dispatch</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.request">request</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.destroyed">destroyed</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In wayland_server</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="index.html">wayland_server</a>::<wbr><a class="trait" href="#">Dispatch</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/wayland_server/dispatch.rs.html#87-115">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Dispatch&lt;I: <a class="trait" href="trait.Resource.html" title="trait wayland_server::Resource">Resource</a>, UserData, State = Self&gt;: <a class="trait" href="https://doc.rust-lang.org/1.72.1/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a> {
    // Required method
    fn <a href="#tymethod.request" class="fn">request</a>(
        state: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;mut State</a>,
        client: &amp;<a class="struct" href="struct.Client.html" title="struct wayland_server::Client">Client</a>,
        resource: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;I</a>,
        request: I::<a class="associatedtype" href="trait.Resource.html#associatedtype.Request" title="type wayland_server::Resource::Request">Request</a>,
        data: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;UserData</a>,
        dhandle: &amp;<a class="struct" href="struct.DisplayHandle.html" title="struct wayland_server::DisplayHandle">DisplayHandle</a>,
        data_init: &amp;mut <a class="struct" href="struct.DataInit.html" title="struct wayland_server::DataInit">DataInit</a>&lt;'_, State&gt;
    );

    // Provided method
    fn <a href="#method.destroyed" class="fn">destroyed</a>(
        _state: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;mut State</a>,
        _client: <a class="struct" href="backend/struct.ClientId.html" title="struct wayland_server::backend::ClientId">ClientId</a>,
        _resource: <a class="struct" href="backend/struct.ObjectId.html" title="struct wayland_server::backend::ObjectId">ObjectId</a>,
        _data: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;UserData</a>
    ) { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait which provides an implementation for handling a client’s requests from a resource with some type
of associated user data.</p>
<h3 id="general-usage"><a href="#general-usage">General usage</a></h3>
<p>You need to implement this trait on your <code>State</code> for every type of Wayland object that will be processed
by the <a href="struct.Display.html" title="struct wayland_server::Display"><code>Display</code></a> working with your <code>State</code>.</p>
<p>You can have different implementations of the trait for the same interface but different <code>UserData</code> type,
this way the events for a given object will be processed by the adequate implementation depending on
which <code>UserData</code> was assigned to it at creation.</p>
<p>The way this trait works is that the <a href="trait.Dispatch.html#tymethod.request" title="associated function wayland_server::Dispatch::request"><code>Dispatch::request()</code></a> method will be invoked by the
<a href="struct.Display.html" title="struct wayland_server::Display"><code>Display</code></a> for every request received by an object. Your implementation can then match
on the associated <a href="trait.Resource.html#associatedtype.Request" title="associated type wayland_server::Resource::Request"><code>Resource::Request</code></a> enum and do any processing needed with that event.</p>
<p>If the request being processed created a new object, you’ll receive it as a <a href="struct.New.html" title="struct wayland_server::New"><code>New&lt;I&gt;</code></a>. When that is the
case, you <em>must</em> initialize it using the <a href="struct.DataInit.html" title="struct wayland_server::DataInit"><code>DataInit</code></a> argument. **Failing to do so will cause a <strong>panic</strong>.</p>
<h3 id="modularity"><a href="#modularity">Modularity</a></h3>
<p>To provide generic handlers for downstream usage, it is possible to make an implementation of the trait
that is generic over the last type argument, as illustrated below. Users will then be able to
automatically delegate their implementation to yours using the [<code>delegate_dispatch!</code>] macro.</p>
<p>As a result, when your implementation is instanciated, the last type parameter <code>State</code> will be the state
struct of the app using your generic implementation. You can put additional trait constraints on it to
specify an interface between your module and downstream code, as illustrated in this example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>wayland_server::{protocol::wl_output, Dispatch};

<span class="doccomment">/// The type we want to delegate to
</span><span class="kw">struct </span>DelegateToMe;

<span class="doccomment">/// The user data relevant for your implementation.
/// When providing delegate implementation, it is recommended to use your own type here, even if it is
/// just a unit struct: using () would cause a risk of clashing with an other such implementation.
</span><span class="kw">struct </span>MyUserData;

<span class="comment">// Now a generic implementation of Dispatch, we are generic over the last type argument instead of using
// the default State=Self.
</span><span class="kw">impl</span>&lt;State&gt; Dispatch&lt;wl_output::WlOutput, MyUserData, State&gt; <span class="kw">for </span>DelegateToMe
<span class="kw">where
    </span><span class="comment">// State is the type which has delegated to this type, so it needs to have an impl of Dispatch itself
    </span>State: Dispatch&lt;wl_output::WlOutput, MyUserData&gt;,
    <span class="comment">// If your delegate type has some internal state, it&#39;ll need to access it, and you can
    // require it by adding custom trait bounds.
    // In this example, we just require an AsMut implementation
    </span>State: AsMut&lt;DelegateToMe&gt;,
{
    <span class="kw">fn </span>request(
        state: <span class="kw-2">&amp;mut </span>State,
        _client: <span class="kw-2">&amp;</span>wayland_server::Client,
        _resource: <span class="kw-2">&amp;</span>wl_output::WlOutput,
        _request: wl_output::Request,
        _udata: <span class="kw-2">&amp;</span>MyUserData,
        _dhandle: <span class="kw-2">&amp;</span>wayland_server::DisplayHandle,
        _data_init: <span class="kw-2">&amp;mut </span>wayland_server::DataInit&lt;<span class="lifetime">&#39;_</span>, State&gt;,
    ) {
        <span class="comment">// Here the delegate may handle incoming requests as it pleases.

        // For example, it retrives its state and does some processing with it
        </span><span class="kw">let </span>me: <span class="kw-2">&amp;mut </span>DelegateToMe = state.as_mut();
        <span class="comment">// do something with `me` ...
    </span>}
}</code></pre></div>
<p><strong>Note:</strong> Due to limitations in Rust’s trait resolution algorithm, a type providing a generic
implementation of <a href="trait.Dispatch.html" title="trait wayland_server::Dispatch"><code>Dispatch</code></a> cannot be used directly as the dispatching state, as rustc
currently fails to understand that it also provides <code>Dispatch&lt;I, U, Self&gt;</code> (assuming all other
trait bounds are respected as well).</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.request" class="method"><a class="srclink rightside" href="../src/wayland_server/dispatch.rs.html#93-101">source</a><h4 class="code-header">fn <a href="#tymethod.request" class="fn">request</a>(
    state: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;mut State</a>,
    client: &amp;<a class="struct" href="struct.Client.html" title="struct wayland_server::Client">Client</a>,
    resource: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;I</a>,
    request: I::<a class="associatedtype" href="trait.Resource.html#associatedtype.Request" title="type wayland_server::Resource::Request">Request</a>,
    data: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;UserData</a>,
    dhandle: &amp;<a class="struct" href="struct.DisplayHandle.html" title="struct wayland_server::DisplayHandle">DisplayHandle</a>,
    data_init: &amp;mut <a class="struct" href="struct.DataInit.html" title="struct wayland_server::DataInit">DataInit</a>&lt;'_, State&gt;
)</h4></section></summary><div class="docblock"><p>Called when a request from a client is processed.</p>
<p>The implementation of this function will vary depending on what protocol is being implemented. Typically
the server may respond to clients by sending events to the resource, or some other resource stored in
the user data.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.destroyed" class="method"><a class="srclink rightside" href="../src/wayland_server/dispatch.rs.html#114">source</a><h4 class="code-header">fn <a href="#method.destroyed" class="fn">destroyed</a>(
    _state: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;mut State</a>,
    _client: <a class="struct" href="backend/struct.ClientId.html" title="struct wayland_server::backend::ClientId">ClientId</a>,
    _resource: <a class="struct" href="backend/struct.ObjectId.html" title="struct wayland_server::backend::ObjectId">ObjectId</a>,
    _data: <a class="primitive" href="https://doc.rust-lang.org/1.72.1/std/primitive.reference.html">&amp;UserData</a>
)</h4></section></summary><div class="docblock"><p>Called when the object this user data is associated with has been destroyed.</p>
<p>Note this type only provides an immutable reference to the user data, you will need to use
interior mutability to change it.</p>
<p>Typically a <a href="https://doc.rust-lang.org/1.72.1/std/sync/mutex/struct.Mutex.html" title="struct std::sync::mutex::Mutex"><code>Mutex</code></a> would be used to have interior mutability.</p>
<p>You are given the <a href="backend/struct.ObjectId.html" title="struct wayland_server::backend::ObjectId"><code>ObjectId</code></a> and <a href="backend/struct.ClientId.html" title="struct wayland_server::backend::ClientId"><code>ClientId</code></a> associated with the destroyed object for cleanup
convenience.</p>
<p>By default this method does nothing.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../implementors/wayland_server/dispatch/trait.Dispatch.js" async></script></section></div></main></body></html>